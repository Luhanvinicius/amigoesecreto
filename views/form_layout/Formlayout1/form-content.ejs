<main>
    <section class="appointment-sec align-center pt pb">
        <div class="container">
            <!-- Botão voltar ao site -->
            <div class="row mb-3">
                <div class="col-12">
                    <a href="/" class="btn-back-to-site" style="display: inline-flex; align-items: center; gap: 0.5rem; color: #667eea; text-decoration: none; font-weight: 500; padding: 0.5rem 1rem; border: 2px solid #667eea; border-radius: 8px; transition: all 0.3s;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Voltar ao Site
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-4 col-12">
                    <div class="form-steps-left">
                        <div class="section-title">
                            <h2>Agende sua Conversa</h2>
                        </div>
                        <div class="steps">
                            <ul>
                                <li class="stapes_status">
                                    Serviço
                                </li>
                                <li class="stapes_status step-schedule" id="step-schedule-indicator">
                                    Escolha um Horário
                                </li>
                                <li class="stapes_status">
                                    Conte-me mais sobre você
                                </li>
                                <li class="stapes_status">
                                    Seus Dados
                                </li>
                                <li class="stapes_status">
                                    Pagamento
                                </li>
                                <li class="stapes_status">
                                    Concluído
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-8 col-12">
                    <form method="POST" action="/appointments/book" id="appointment-form" class="appointment-forms" enctype="multipart/form-data" novalidate>
                        <input type="hidden" name="_token" value="<%= csrfToken %>">
                        <input type="hidden" name="requires_schedule" id="requires_schedule" value="1">
                        <div class="myContainer">
                            <!-- STEP 1: Seleção de Serviço -->
                            <div class="step-container active" id="step-first">
                                <div class="appointment-wrp Shoppint-Cart-btn">
                                    <h2 class="mb-4">Agende sua Conversa</h2>
                                    <div class="appointment-form">
                                        <h3>Por favor, selecione os serviços:</h3>
                                        <div class="row">
                                            <div class="col-md-6 col-12">
                                                <div class="form-group">
                                                    <label>Escolha um Serviço</label>
                                                    <select id="serviceSelect" name="service" required>
                                                        <option value="" disabled<% if (!selectedService) { %> selected<% } %>>
                                                            Selecione Serviços
                                                        </option>
                                                        <% services.forEach(function(service) { %>
                                                        <option value="<%= service.id %>" 
                                                                class="service" 
                                                                data-price="<%= service.price || 0 %>"
                                                                data-requires-schedule="<%= service.requires_schedule !== undefined ? service.requires_schedule : 1 %>"
                                                                <% if (selectedService && selectedService == service.id) { %> selected<% } %>>
                                                            <%= service.name %>
                                                        </option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group">
                                                    <label>Escolha um Local de Contato</label>
                                                    <select id="locationSelect" name="location" required>
                                                        <option value="" disabled selected>
                                                            Selecione onde quer conversar
                                                        </option>
                                                        <% locations.forEach(function(location) { %>
                                                        <option value="<%= location.id %>"><%= location.name %></option>
                                                        <% }); %>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-btns">
                                        <div class="action-btn">
                                            <button type="button" name="next" class="next btn sequential_button">
                                                Próximo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- STEP 2: Escolha de Horário (pula para pacotes de mensagem) -->
                            <div class="step-container" id="step-schedule">
                                <div class="appointment-wrp Shoppint-Cart-btn">
                                    <div class="appointment-form">
                                        <h3>Agendamento:</h3>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Data do Agendamento</label>
                                                    <input class="datepicker" type="text" id="datepicker"
                                                        name="appointment_date" autocomplete="off"
                                                        value="<%= new Date().toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'}).replace(/\//g, '-') %>">
                                                </div>
                                            </div>
                                            <ul class="check-box-div" id="timeSlotsContainer"></ul>
                                        </div>
                                    </div>
                                    <div class="step-btns">
                                        <div class="action-btn">
                                            <button type="button" name="back" class="back btn btn-transparent">
                                                Voltar
                                            </button>
                                            <button type="button" name="next" class="cart-save next btn">
                                                Próximo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- STEP 3: Campos Personalizados -->
                            <div class="step-container" id="step-custom-fields">
                                <div class="appointment-wrp">
                                    <div class="appointment-form">
                                        <h3>Conte-me mais sobre você:</h3>
                                        <p style="color: #666; margin-bottom: 1.5rem;">Essas informações nos ajudam a personalizar sua experiência.</p>
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>O que você espera da Lia?</label>
                                                    <small class="text-muted d-block mb-2">Ex: Escuta, Apoio, Aprovação, Desabafo, Conselhos...</small>
                                                    <textarea name="client_expectation" id="client_expectation" 
                                                        class="form-control" rows="3" 
                                                        placeholder="Conte-me o que você espera dessa conversa..."></textarea>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-group">
                                                    <label>Qual o tema da conversa?</label>
                                                    <small class="text-muted d-block mb-2">Pode ser algo específico ou geral, você decide.</small>
                                                    <textarea name="conversation_topic" id="conversation_topic" 
                                                        class="form-control" rows="3" 
                                                        placeholder="Sobre o que você gostaria de conversar?"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-12">
                                                <div class="form-group">
                                                    <label>Seu @ do Instagram</label>
                                                    <small class="text-muted d-block mb-2">Se preferir contato por lá, informe seu @</small>
                                                    <input type="text" name="client_instagram" id="client_instagram" 
                                                        class="form-control" placeholder="@seuinsta">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <% if ((files && files.value === 'on') || (customField === 'on')) { %>
                                        <hr style="margin: 2rem 0;">
                                        <h4>Detalhes Adicionais:</h4>
                                        <% if (customField === 'on' && customFields && customFields.length > 0) { %>
                                        <div class="row">
                                            <% customFields.forEach(function(customField) { %>
                                            <div class="col-md-6 col-12 form-group">
                                                <% if (['textfield', 'textarea', 'date', 'number'].includes(customField.type)) { %>
                                                <label for="<%= customField.label %>"><%= customField.label %></label>
                                                <% } %>
                                                <% if (customField.type === 'textfield') { %>
                                                <input type="text"
                                                    name="values[textfield][<%= customField.label %>]"
                                                    placeholder="Valor" value="<%= customField.value || '' %>"
                                                    class="form-control">
                                                <% } else if (customField.type === 'textarea') { %>
                                                <textarea name="values[textarea][<%= customField.label %>]" 
                                                    placeholder="Valor" class="form-control"><%= customField.value || '' %></textarea>
                                                <% } else if (customField.type === 'date') { %>
                                                <input type="date" class="form-control"
                                                    name="values[date][<%= customField.label %>]"
                                                    value="<%= customField.value || '' %>">
                                                <% } else if (customField.type === 'number') { %>
                                                <input type="number" class="form-control"
                                                    name="values[number][<%= customField.label %>]"
                                                    placeholder="Valor"
                                                    value="<%= customField.value || '' %>">
                                                <% } %>
                                            </div>
                                            <% }); %>
                                        </div>
                                        <% } %>

                                        <% if (files && files.value === 'on') { %>
                                        <div class="row">
                                            <div class="col-sm-3 col-12">
                                                <div class="form-group">
                                                    <label for="attachment"><%= files.label || 'Anexo' %></label>
                                                    <div class="chose-files" id="myfile">
                                                        <i class="ti ti-upload px-1"></i>
                                                        <span>Escolha o arquivo aqui</span>
                                                        <input type="file" name="attachment" id="attachment"
                                                            data-filename="attachment"
                                                            placeholder="Choose file here">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% } %>
                                        <% } %>
                                    </div>
                                    <div class="step-btns">
                                        <button type="button" name="back" class="back btn btn-transparent">
                                            Voltar
                                        </button>
                                        <button type="button" name="next" class="next btn">
                                            Próximo
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- STEP 4: Dados do Usuário -->
                            <div class="step-container final_stepss">
                                <div class="appointment-wrp tab-wrp">
                                    <div class="tabs-wrapper">
                                        <div class="alert alert-danger flex align-center d-none" role="alert">
                                            <svg height="26" viewBox="0 0 128 128" width="26" xmlns="http://www.w3.org/2000/svg">
                                                <g>
                                                    <path d="m57.362 26.54-37.262 64.535a7.666 7.666 0 0 0 6.639 11.5h74.518a7.666 7.666 0 0 0 6.639-11.5l-37.258-64.535a7.665 7.665 0 0 0 -13.276 0z" fill="#ee404c"></path>
                                                    <g fill="#fff7ed">
                                                        <rect height="29.377" rx="4.333" width="9.638" x="59.181" y="46.444"></rect>
                                                        <circle cx="64" cy="87.428" r="4.819"></circle>
                                                    </g>
                                                </g>
                                            </svg>
                                            <div class="error-msg"></div>
                                        </div>
                                        <ul class="tabs">
                                            <% if (!bookingModes || bookingModes.includes('1')) { %>
                                            <li data-tab="new-user" class="tab-link<% if (bookingModes && bookingModes.includes('1')) { %> active<% } %>">
                                                <a href="javascript:;">1. Novo Cadastro</a>
                                            </li>
                                            <% } %>
                                            <% if (!bookingModes || bookingModes.includes('1')) { %>
                                            <li data-tab="existing-user" class="tab-link">
                                                <a href="javascript:;">2. Já Tenho Conta</a>
                                            </li>
                                            <% } %>
                                            <% if (bookingModes && bookingModes.includes('2')) { %>
                                            <li data-tab="guest-user" class="tab-link<% if (!bookingModes.includes('1') && bookingModes.includes('2')) { %> active<% } %>">
                                                <a href="javascript:;">3. Agendamento como Convidado</a>
                                            </li>
                                            <% } %>
                                        </ul>
                                        <input type="hidden" name="type" id="selected_tab" value="new-user">
                                        <div class="tabs-container">
                                            <% if (!bookingModes || bookingModes.includes('1')) { %>
                                            <div id="new-user" class="tab-content active" style="display: block;">
                                                <div class="row">
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>Como quer ser chamado(a)?</label>
                                                            <small class="text-muted d-block mb-1">Pode ser um apelido, nome fictício ou real</small>
                                                            <input type="text" class="form-control" name="name"
                                                                id="name_new" placeholder="Seu nome ou apelido">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>E-mail <span style="color: #e74c3c;">*</span></label>
                                                            <input type="email" class="form-control" name="email"
                                                                id="email_new" placeholder="Seu E-mail" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>Senha</label>
                                                            <small class="text-muted d-block mb-1">Para acessar sua área depois</small>
                                                            <input type="password" class="form-control" name="password"
                                                                id="password" placeholder="Crie uma senha">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>WhatsApp/Telefone</label>
                                                            <small class="text-muted d-block mb-1">(+5511999999999)</small>
                                                            <input type="text" class="form-control" name="contact"
                                                                id="contact" placeholder="Número de Telefone">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                            <% if (!bookingModes || bookingModes.includes('1')) { %>
                                            <div id="existing-user" class="tab-content" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>E-mail <span style="color: #e74c3c;">*</span></label>
                                                            <input type="email" class="form-control" name="email"
                                                                id="email_existing" placeholder="Seu E-mail" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>Senha <span style="color: #e74c3c;">*</span></label>
                                                            <input type="password" class="form-control" name="password"
                                                                id="password_existing" placeholder="Sua Senha" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <a href="/forgot-password" style="color: #667eea; text-decoration: none; font-size: 0.9rem;">
                                                            Esqueceu sua senha?
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <% } %>
                                            <div id="guest-user" class="tab-content<% if (bookingModes && !bookingModes.includes('1') && bookingModes.includes('2')) { %> active<% } %>"<% if (!(bookingModes && !bookingModes.includes('1') && bookingModes.includes('2'))) { %> style="display: none;"<% } %>>
                                                <div class="row">
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>Como quer ser chamado(a)?</label>
                                                            <small class="text-muted d-block mb-1">Pode ser um apelido</small>
                                                            <input type="text" class="form-control" name="name"
                                                                id="name_guest" placeholder="Seu nome ou apelido">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>E-mail <span style="color: #e74c3c;">*</span></label>
                                                            <input type="email" class="form-control" name="email"
                                                                id="email_guest" placeholder="Seu E-mail" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label>WhatsApp/Telefone</label>
                                                            <small class="text-muted d-block mb-1">(+5511999999999)</small>
                                                            <input type="text" class="form-control" name="contact"
                                                                id="contact_guest" placeholder="Número de Telefone">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-btns">
                                        <button type="button" name="BACK" class="back btn btn-transparent">
                                            Voltar
                                        </button>
                                        <button type="button" name="next" class="next btn">
                                            Próximo
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- STEP 5: Pagamento -->
                            <div class="step-container">
                                <div class="appointment-wrp">
                                    <div class="free-appointment"></div>
                                    <div class="appointment-form payment-method-form">
                                        <div class="section-title">
                                            <h3>Pagamento:</h3>
                                            <div class="flex appointment_info_details">
                                                <p class="h6" id="serviceAmount"></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-6 col-lg-4 col-12">
                                                <div class="radio-group">
                                                    <input class="form-check-input payment_method" name="payment_method"
                                                        type="radio" id="asaas_pix" data-payment="asaas_pix"
                                                        data-payment-action="/appointments/book" checked>
                                                    <label for="asaas_pix">
                                                        <div class="radio-img">
                                                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <rect width="24" height="24" rx="4" fill="#32BCAD"/>
                                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="white"/>
                                                            </svg>
                                                        </div>
                                                        <p>PIX (Asaas)</p>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-lg-4 col-12" id="paypal-option" style="display: none;">
                                                <div class="radio-group">
                                                    <input class="form-check-input payment_method" name="payment_method"
                                                        type="radio" id="paypal" data-payment="paypal"
                                                        data-payment-action="/appointments/book">
                                                    <label for="paypal">
                                                        <div class="radio-img">
                                                            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                <rect width="24" height="24" rx="4" fill="#003087"/>
                                                                <path d="M7.5 19.5h2l.5-3h2c2.5 0 4-1.5 4.5-4 .5-2.5-1-4-3.5-4h-4l-2 11zm3-7l.5-3h1.5c1 0 1.5.5 1.5 1.5s-.5 1.5-1.5 1.5h-2z" fill="white"/>
                                                            </svg>
                                                        </div>
                                                        <p>PayPal</p>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="payment-info" style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; display: none;">
                                            <p style="margin: 0; color: #0369a1; font-weight: 600;">Você será redirecionado para o pagamento após confirmar o agendamento.</p>
                                        </div>
                                    </div>
                                    <div class="step-btns finle-step-btn flex align-center">
                                        <div class="action-btn">
                                            <div class="step-btn-wrapper">
                                                <button type="button" name="back" class="back btn btn-transparent">Voltar</button>
                                                <button type="submit" name="submit" class="btn appointment_payment" id="generate-payment-btn">Gerar Pagamento</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- STEP 6: Concluído (não usado mais - redirecionamos para página done) -->
                            <div class="step-container" id="final_step">
                                <div class="appointment-wrp">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group">
                                                <span>
                                                    <svg id="fi_13965236" enable-background="new 0 0 100 100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="20px">
                                                        <path d="m92.8660965 38.8007011c-1.4883041-1.4884987-2.6493912-3.2300644-3.4410553-5.1301155-.7916718-1.9000511-1.2033539-3.9583321-1.2033539-6.0588779 0-4.3804531-1.7733231-8.3284779-4.6339035-11.1995583-2.8710785-2.8605137-6.8189087-4.6337748-11.1994247-4.6337748-4.2010956 0-8.2227554-1.66786-11.1889305-4.6443415-3.0927697-3.0929631-7.1460686-4.6340331-11.1994286-4.6340331-4.053299 0-8.1066589 1.54107-11.1994286 4.6340332-1.4883041 1.4882402-3.2299995 2.6491966-5.1299858 3.4408636s-3.9583321 1.2034779-6.0588779 1.2034779c-4.3805809 0-8.3283482 1.7732611-11.1994934 4.6337748-2.8605137 2.8710804-4.6338396 6.8191051-4.6338396 11.1995583 0 2.1005459-.4116821 4.1588268-1.2033482 6.0588779-.791667 1.9000511-1.952817 3.6416168-3.4411216 5.1301155-3.0927701 3.0927047-4.6339042 7.145874-4.6339042 11.1992988 0 4.0531693 1.5411341 8.1065941 4.6339045 11.1992989 1.4883046 1.4884987 2.6494546 3.2300606 3.4411216 5.1301155.791666 1.9000473 1.2033482 3.9583359 1.2033482 6.058876 0 4.380455 1.7733259 8.328476 4.6338396 11.1995621 2.8711452 2.8605118 6.8189125 4.6337738 11.1994934 4.6337738 2.1005459 0 4.1588917.4118118 6.0588779 1.203476s3.6416817 1.9526215 5.1299858 3.4408646c3.0927694 3.0929641 7.1461293 4.6340331 11.1994283 4.6340331 4.05336 0 8.1066589-1.541069 11.1994286-4.6340332 1.488369-1.4882431 3.2300606-2.6492004 5.1300468-3.4408646s3.9583359-1.203476 6.0588837-1.203476c4.3805161 0 8.3283463-1.773262 11.1994247-4.6337738 2.8605804-2.8710861 4.6339035-6.8191071 4.6339035-11.1995621 0-2.1005402.4116821-4.1588287 1.2033539-6.058876.7916641-1.9000549 1.9527512-3.6416168 3.4410553-5.1301155 3.0928345-3.0927047 4.6339035-7.1461295 4.6339035-11.1992988 0-4.0534248-1.541069-8.1065941-4.6339035-11.1992989zm-19.8655014.1476632-28.0672493 28.0673141c-.7916679.7916641-1.8683548 1.2349167-2.9872398 1.2349167s-2.1955109-.4432526-2.987175-1.2349167l-11.9594632-11.9595261c-1.6466637-1.6467285-1.6466637-4.3173141 0-5.9746094 1.6466637-1.6464691 4.3277512-1.6464691 5.9744167 0l8.9722214 8.9830475 25.0800095-25.0802689c1.6466675-1.646471 4.3278198-1.646471 5.9744797 0 1.6466675 1.6467286 1.6466675 4.3173142 0 5.9640428z"></path>
                                                    </svg>
                                                    <label id="appointment_number"></label>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="step-btns">
                                        <a href="/appointments/<%= slug %>" class="btn btn-transparent">Fazer Novo Agendamento</a>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="business_id" value="<%= business.id %>">
                            <input type="hidden" name="payment" value="manually">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>

<style>
/* Estilo para step que não precisa de horário */
.step-schedule.hidden-step {
    display: none !important;
}

/* Melhor estilo para campos não obrigatórios */
.form-group small.text-muted {
    font-size: 0.8rem;
    opacity: 0.8;
}

/* PayPal option styling */
#paypal-option.active {
    display: block !important;
}
</style>

<script>
// Controle de serviços que não precisam de horário
document.addEventListener('DOMContentLoaded', function() {
    var serviceSelect = document.getElementById('serviceSelect');
    var stepScheduleIndicator = document.getElementById('step-schedule-indicator');
    var stepSchedule = document.getElementById('step-schedule');
    var requiresScheduleInput = document.getElementById('requires_schedule');
    
    // Lista de IDs de serviços que NÃO precisam de horário
    var noScheduleServices = [4, 5]; // Mensagem de texto e Áudio, Assinatura Mensal texto e áudio
    
    function updateScheduleRequirement() {
        var selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
        var requiresSchedule = selectedOption.getAttribute('data-requires-schedule');
        
        // Se não tem atributo, verificar pelo ID do serviço
        if (requiresSchedule === null || requiresSchedule === undefined) {
            var serviceId = parseInt(serviceSelect.value);
            requiresSchedule = noScheduleServices.includes(serviceId) ? '0' : '1';
        }
        
        var needsSchedule = requiresSchedule !== '0';
        
        // Atualizar hidden input
        requiresScheduleInput.value = needsSchedule ? '1' : '0';
        
        // Mostrar/esconder step de horário
        if (needsSchedule) {
            stepScheduleIndicator.classList.remove('hidden-step');
            stepSchedule.classList.remove('skip-step');
        } else {
            stepScheduleIndicator.classList.add('hidden-step');
            stepSchedule.classList.add('skip-step');
        }
        
        console.log('Serviço selecionado:', serviceSelect.value, 'Precisa de horário:', needsSchedule);
    }
    
    serviceSelect.addEventListener('change', updateScheduleRequirement);
    
    // Verificar PayPal está ativo
    // TODO: Carregar do servidor se PayPal está configurado
    var paypalActive = false; // Mudar para true quando PayPal estiver configurado
    if (paypalActive) {
        document.getElementById('paypal-option').style.display = 'block';
    }
});

// Sobrescrever função de navegação para pular step de horário quando não necessário
(function() {
    var originalNextHandler = null;
    
    document.addEventListener('DOMContentLoaded', function() {
        // Interceptar cliques no botão próximo
        document.querySelectorAll('.step-container .next').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                var currentStep = this.closest('.step-container');
                var nextStep = currentStep.nextElementSibling;
                
                // Se o próximo step é o de horário e não precisa, pular
                if (nextStep && nextStep.id === 'step-schedule' && nextStep.classList.contains('skip-step')) {
                    e.stopPropagation();
                    
                    // Pular para o próximo step válido
                    var targetStep = nextStep.nextElementSibling;
                    if (targetStep) {
                        currentStep.classList.remove('active');
                        targetStep.classList.add('active');
                        
                        // Atualizar indicadores
                        var currentIndex = Array.from(document.querySelectorAll('.step-container')).indexOf(currentStep);
                        var targetIndex = Array.from(document.querySelectorAll('.step-container')).indexOf(targetStep);
                        
                        document.querySelectorAll('.steps li').forEach(function(li, idx) {
                            if (idx <= targetIndex - 1) { // -1 porque o step de schedule foi pulado
                                li.classList.add('completed');
                            }
                            li.classList.remove('active');
                        });
                        
                        // Ativar o indicador correto (pular o hidden)
                        var visibleSteps = document.querySelectorAll('.steps li:not(.hidden-step)');
                        var targetVisibleIndex = 0;
                        document.querySelectorAll('.steps li').forEach(function(li, idx) {
                            if (idx < targetIndex && !li.classList.contains('hidden-step')) {
                                targetVisibleIndex++;
                            }
                        });
                        
                        if (visibleSteps[targetVisibleIndex]) {
                            visibleSteps[targetVisibleIndex].classList.add('active');
                        }
                    }
                }
            }, true); // Captura na fase de captura
        });
        
        // Interceptar cliques no botão voltar
        document.querySelectorAll('.step-container .back').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                var currentStep = this.closest('.step-container');
                var prevStep = currentStep.previousElementSibling;
                
                // Se o step anterior é o de horário e não precisa, pular
                if (prevStep && prevStep.id === 'step-schedule' && prevStep.classList.contains('skip-step')) {
                    e.stopPropagation();
                    
                    // Voltar para o step anterior válido
                    var targetStep = prevStep.previousElementSibling;
                    if (targetStep) {
                        currentStep.classList.remove('active');
                        targetStep.classList.add('active');
                        
                        // Atualizar indicadores
                        var targetIndex = Array.from(document.querySelectorAll('.step-container')).indexOf(targetStep);
                        document.querySelectorAll('.steps li').forEach(function(li, idx) {
                            li.classList.remove('active', 'completed');
                        });
                        document.querySelectorAll('.steps li')[targetIndex].classList.add('active');
                    }
                }
            }, true);
        });
    });
})();
</script>
